#include "mbed.h"
 //sensors
DigitalIn S1(PTD1);
DigitalIn S2(PTD3);
DigitalIn S3(PTD2);
DigitalIn S4(PTD0);
DigitalIn S5(PTD5);
DigitalIn S6(PTA13);
    //Right
PwmOut PwmR(PTA12);
DigitalOut Rforward(PTA2);
DigitalOut Rbackward(PTD4);
    //Left
PwmOut PwmL(PTA1);
DigitalOut Lforward(PTA5);
DigitalOut Lbackward(PTA4);
DigitalOut magnet(PTE31);

void controlLeft(float dutycycle, bool direction) {
    if (PwmL != dutycycle){
       PwmL = dutycycle;
   }
    if (direction == 1){
        Lforward = 1;
        Lbackward =0;
    }
    else{
        Lforward = 0;
        Lbackward = 1;
    }
}    
void controlRight(float dutycycle, bool direction) {
    if (PwmR != dutycycle){
       PwmR = dutycycle;
    }
    if (direction == 1){
        Rforward = 1;
        Rbackward =0;
    }
    else{
        Rforward = 0;
       Rbackward = 1;
    }
}    

void on_line (){
  controlLeft(0.15,1);
  controlRight(0.15,1);
}

void turn_left (){
  controlLeft(0.1,0);
  controlRight(0.4,1);
}

void turn_left_slow (){
  controlLeft(0.1,0);
  controlRight(0.2,1);
}

void turn_right(){
   controlLeft(0.4,1);
  controlRight(0.1,0);
}

void turn_right_slow(){
   controlLeft(0.2,1);
  controlRight(0.1,0);
}

void find_line(){
  controlLeft(0.3,0);
  controlRight(0.3,0);
}

void corner_L(){
  controlLeft(0.2,0);
  controlRight(0.5,1);
}

void corner_R(){
  controlLeft(0.5,1);
  controlRight(0.2,0);
}


int main(){
    magnet=1;
    int cases = 0;
    while(1){
if (S2==1 && S3==1 && S4==1 && S5==1){
    cases=1;
}else if (S2==1 && S3==0 && S4==1 && S5==1){
    cases=2;
}else if (S2==0 && S3==1 && S4==1 && S5==1){
    cases=3;
}else if (S2==1 && S3==1 && S4==0 && S5==1){
    cases=4;
}else if (S2==1 && S3==1 && S4==1 && S5==0){
    cases=5;
}else if (S2==1 && S3==1 && S4==0 && S5==0){
    cases=6;
}else if (S2==0 && S3==0 && S4==1 && S5==1){
    cases=7;
}
switch(cases){
    case 1:
    on_line();
    break;

    case 2:
    turn_left_slow();
    break;

    case 3:
    turn_left();
    wait_us(1000);
    break;

    case 4:
    turn_right_slow();
    break;

    case 5:
    turn_right();
    wait_us(1000);
    break;

    case 6:
    corner_L();
    break;

    case 7:
    corner_R();
    break;

  }
 wait_us(10000);
 }

}
